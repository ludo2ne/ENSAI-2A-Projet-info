<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rémi Pépin, Ludovic Deneuville">
<meta name="description" content="TP 3">

<title>Webservices et formats de données – Projet info 2A</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b651517ce65839d647a86e2780455cfb.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3bfab430b3a0f1eddad8a0d61863e953.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-a2bfeeca8d941e7f328a7b92742c06b1.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const darkModeDefault = authorPrefersDark;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Projet info 2A</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projet" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projet</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projet">    
        <li>
    <a class="dropdown-item" href="../../doc/projet/presentation-tuteurs.html">
 <span class="dropdown-text">Présentation pour les tuteurs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/presentation-eleves.html">
 <span class="dropdown-text">Présentation aux élèves</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/notice-eleves.html">
 <span class="dropdown-text">Notice élèves</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ludo2ne/ENSAI-2A-projet-info-template">
 <span class="dropdown-text">Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/sujets-2025-2026.html">
 <span class="dropdown-text">Sujets 2025-2026</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="../../doc/cours/intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/outils-dev.html">
 <span class="dropdown-text">Outils de développement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ludo2ne.github.io/Git-tuto/doc/presentation.html" target="_blank">
 <span class="dropdown-text">Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/analyse-fonctionnelle.html">
 <span class="dropdown-text">Analyse fonctionnelle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/poo-avancee.html">
 <span class="dropdown-text">POO Avancée</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/tests-unitaires.html">
 <span class="dropdown-text">Tests unitaires</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/webservices.html">
 <span class="dropdown-text">Webservices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/dao-securite.html">
 <span class="dropdown-text">DAO et Sécurité</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tp">    
        <li>
    <a class="dropdown-item" href="../../doc/tp/tools.html">
 <span class="dropdown-text">Tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp1.html">
 <span class="dropdown-text">TP 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp2.html">
 <span class="dropdown-text">TP 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp3.html">
 <span class="dropdown-text">TP 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp4.html">
 <span class="dropdown-text">TP 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-divers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Divers</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-divers">    
        <li>
    <a class="dropdown-item" href="../../doc/divers/licences.html">
 <span class="dropdown-text">Licences</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/divers/sigles.html">
 <span class="dropdown-text">Sigles</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ludo2ne/ENSAI-2A-Projet-info" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#before-you-start" id="toc-before-you-start" class="nav-link active" data-scroll-target="#before-you-start">Before you start</a></li>
  <li><a href="#calling-manually-a-web-service" id="toc-calling-manually-a-web-service" class="nav-link" data-scroll-target="#calling-manually-a-web-service"><span class="header-section-number">1</span> Calling manually a web service</a>
  <ul class="collapse">
  <li><a href="#webservices" id="toc-webservices" class="nav-link" data-scroll-target="#webservices"><span class="header-section-number">1.1</span> Webservices</a></li>
  <li><a href="#first-get-requests" id="toc-first-get-requests" class="nav-link" data-scroll-target="#first-get-requests"><span class="header-section-number">1.2</span> First GET requests</a></li>
  <li><a href="#advanced-queries" id="toc-advanced-queries" class="nav-link" data-scroll-target="#advanced-queries"><span class="header-section-number">1.3</span> Advanced queries</a></li>
  <li><a href="#swagger" id="toc-swagger" class="nav-link" data-scroll-target="#swagger"><span class="header-section-number">1.4</span> Swagger</a></li>
  </ul></li>
  <li><a href="#python-webservice" id="toc-python-webservice" class="nav-link" data-scroll-target="#python-webservice"><span class="header-section-number">2</span> Python Webservice</a>
  <ul class="collapse">
  <li><a href="#requests-library" id="toc-requests-library" class="nav-link" data-scroll-target="#requests-library"><span class="header-section-number">2.1</span> Requests Library</a></li>
  <li><a href="#examples-of-use" id="toc-examples-of-use" class="nav-link" data-scroll-target="#examples-of-use"><span class="header-section-number">2.2</span> Examples of use</a></li>
  <li><a href="#launch-vscode" id="toc-launch-vscode" class="nav-link" data-scroll-target="#launch-vscode"><span class="header-section-number">2.3</span> Launch VScode</a></li>
  <li><a href="#clone-the-repository" id="toc-clone-the-repository" class="nav-link" data-scroll-target="#clone-the-repository"><span class="header-section-number">2.4</span> Clone the repository</a></li>
  <li><a href="#my-first-queries-in-python" id="toc-my-first-queries-in-python" class="nav-link" data-scroll-target="#my-first-queries-in-python"><span class="header-section-number">2.5</span> My first queries in Python</a></li>
  <li><a href="#more-complex-requests" id="toc-more-complex-requests" class="nav-link" data-scroll-target="#more-complex-requests"><span class="header-section-number">2.6</span> More complex requests</a></li>
  <li><a href="#advanced-requests-in-python" id="toc-advanced-requests-in-python" class="nav-link" data-scroll-target="#advanced-requests-in-python"><span class="header-section-number">2.7</span> Advanced requests in Python</a></li>
  </ul></li>
  <li><a href="#code-a-web-service-in-python" id="toc-code-a-web-service-in-python" class="nav-link" data-scroll-target="#code-a-web-service-in-python"><span class="header-section-number">3</span> Code a web service in Python</a>
  <ul class="collapse">
  <li><a href="#my-first-web-service" id="toc-my-first-web-service" class="nav-link" data-scroll-target="#my-first-web-service"><span class="header-section-number">3.1</span> My first web service</a></li>
  </ul></li>
  <li><a href="#end-of-the-lab" id="toc-end-of-the-lab" class="nav-link" data-scroll-target="#end-of-the-lab">End of the Lab</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Webservices et formats de données</h1>
</div>

<div>
  <div class="description">
    TP 3
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rémi Pépin, Ludovic Deneuville </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="before-you-start" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="before-you-start">Before you start</h2>
<p><span class="emoji" data-emoji="scream">😱</span> As you can see, the subject of this practical assignment is also quite extensive. Don’t let that scare you.</p>
<p>It combines comprehensive explanations and practical exercises to ensure maximum self-sufficiency.</p>
<p><strong>You probably won’t finish the whole subject, but that’s okay. It’s there to help you with your IT project.</strong></p>
<div class="callout callout-style-default callout-note callout-titled" title="Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this lab, you will:</p>
<ul>
<li>Manually call a web service using an API Client</li>
<li>Call a web service using the Python library <em>requests</em></li>
<li>Discover the Swagger page of a web service</li>
<li>Manipulate different data formats</li>
<li>Create a web service using the Python framework <a href="https://fastapi.tiangolo.com/" target="_blank">FastAPI</a></li>
</ul>
</div>
</div>
</section>
<section id="calling-manually-a-web-service" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="calling-manually-a-web-service"><span class="header-section-number">1</span> Calling manually a web service</h2>
<p>The first part of this practical assignment does not require you to write any code, but only to make requests to a web service using an API client.</p>
<section id="webservices" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="webservices"><span class="header-section-number">1.1</span> Webservices</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Web service">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Web service
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Web service</strong>: The term web service is a broad one, and it would be difficult to provide a concise definition (<a href="https://en.wikipedia.org/wiki/Web_service" target="_blank">Wikipedia article</a>).</p>
<p>Within the scope of the project, a web service refers to an application accessible via the HTTP (Hypertext Transfer Protocol) protocol, which generally complies with the REST (Representational State Transfer) architecture.</p>
<p>But there are others, such as SOAP (Simple Object Access Protocol) and RPC (Remote Procedure Call).</p>
</div>
</div>
<p>In other words, a web service is an application accessible via the web that can be queried either:</p>
<ul>
<li>to obtain resources</li>
<li>to modify accessible resources</li>
</ul>
<p>A web service can simply be a <strong>single, standardised access point</strong> to data (such as a database interface), but it can also be a <strong>way of controlling an information system</strong> (launching jobs, putting them on hold, retrieving results, etc.).</p>
<p>Web services use the HTTP protocol, which is the web protocol (not the internet protocol). It is the one you use without knowing it with your web browser. Requesting a web service is almost like requesting a web page.</p>
<p>To do this, you need:</p>
<ul>
<li>the address of the resource, its Uniform Resource Identifier (URI)
<ul>
<li>this is a more general concept than Uniform Resource Locator (URL)</li>
</ul></li>
<li>a method (GET, POST, PUT, DELETE, <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" target="_blank">list of methods</a>)</li>
<li>and potentially some data</li>
</ul>
</section>
<section id="first-get-requests" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="first-get-requests"><span class="header-section-number">1.2</span> First GET requests</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this example, we will use a GET request to read data from a web service. A GET request is like asking a question: “Do you have this information?”</p>
<p>If the data exists, the web service responds with it, usually in JSON format. If not, it may return an error like 404 Not Found.</p>
</div>
</div>
<p>Several ways to make GET requests to web services (choose one):</p>
<ul>
<li><a href="https://hoppscotch.io/" target="_blank">https://hoppscotch.io/</a> (Online client)</li>
<li><a href="https://www.usebruno.com/downloads" target="_blank">Bruno</a> (download and install)</li>
<li><a href="https://insomnia.rest/" target="_blank">Insomnia</a> (already installed on ENSAI VMs)</li>
<li>Entering the URL in the address bar of your web browser (Chrome, Firefox…)</li>
<li>command-line cURL : <code>curl -X GET "https://swapi.info/api/people/35"</code></li>
</ul>
<p>Test the web service requests below:</p>
<ul>
<li>Look at the response on the right side of your screen</li>
<li>What are the similarities between the responses?</li>
</ul>
<section id="carbon-intensity" class="level4" data-number="1.2.1">
<h4 data-number="1.2.1" class="anchored" data-anchor-id="carbon-intensity"><span class="header-section-number">1.2.1</span> Carbon intensity</h4>
<p>Web service on carbon emissions in the United Kingdom</p>
<ul>
<li><a href="https://carbon-intensity.github.io/api-definitions/#carbon-intensity-api-v2-0-0" target="_blank">Documentation</a>
<ul>
<li><a href="https://carbon-intensity.github.io/api-definitions/#intensity" target="_blank">Endpoints</a></li>
<li><a href="https://carbon-intensity.github.io/api-definitions/#schemas" target="_blank">Schemas</a></li>
</ul></li>
</ul>
<p>Requests to test:</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>api.carbonintensity.org.uk/intensity</code></label></li>
<li><label><input type="checkbox"><code>api.carbonintensity.org.uk/intensity/date/{date}</code></label>
<ul>
<li>replacing <em>{date}</em> with the date of your choice in the format <em>YYYY-MM-DD</em></li>
</ul></li>
</ul>
</section>
<section id="rennes-métropole-open-data" class="level4" data-number="1.2.2">
<h4 data-number="1.2.2" class="anchored" data-anchor-id="rennes-métropole-open-data"><span class="header-section-number">1.2.2</span> Rennes Métropole open data</h4>
<p><a href="https://data.rennesmetropole.fr/explore/" target="_blank">Data Rennes Métropole</a></p>
<p>Retrieve data from various datasets: <code>https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/&lt;dataset_id&gt;/records</code></p>
<p>Replace <code>&lt;dataset_id&gt;</code> with one of the following values:</p>
<ul class="task-list">
<li><label><input type="checkbox"><em>menus-cantines</em></label></li>
<li><label><input type="checkbox"><em>arbre</em></label></li>
<li><label><input type="checkbox"><em>aire_jeu</em></label></li>
<li><label><input type="checkbox"><em>jeux_aires_de_jeux</em></label></li>
</ul>
<p>To vary the number of rows you receive:</p>
<ul>
<li>simply add to the end of the URI <code>?rows=N</code> , where N is the number of rows</li>
</ul>
</section>
<section id="your-projects-web-service" class="level4" data-number="1.2.3">
<h4 data-number="1.2.3" class="anchored" data-anchor-id="your-projects-web-service"><span class="header-section-number">1.2.3</span> Your project’s web service</h4>
<ul class="task-list">
<li><label><input type="checkbox">Explore some useful methods of your IT project’s web service (discuss this with your tutor).</label></li>
</ul>
</section>
</section>
<section id="advanced-queries" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="advanced-queries"><span class="header-section-number">1.3</span> Advanced queries</h3>
<p>You will use a web service created with FastAPI specifically for this purpose : <strong><a href="https://user-ludo2ne-450102-user.user.lab.sspcloud.fr/docs" target="_blank">https://user-ludo2ne-450102-user.user.lab.sspcloud.fr/docs</a></strong></p>
<div class="callout callout-style-default callout-tip callout-titled" title="If you want to create this web service yourself">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>If you want to create this web service yourself
</div>
</div>
<div class="callout-body-container callout-body">
<p>use this code : <a href="https://github.com/ludo2ne/ENSAI-2A-WS-TP3/" target="_blank">https://github.com/ludo2ne/ENSAI-2A-WS-TP3/</a></p>
<ul>
<li>Create a PostgreSQL service</li>
<li>Using cloudBeaver create and pop table (data/init_db.sql)</li>
<li>Create a Vscode-python service
<ul>
<li>Network access : For example, open port 5000</li>
<li>Clone the repo</li>
<li>Create <em>.env</em> file to connect your PostgreSQL database</li>
<li>install required packages</li>
</ul></li>
<li><code>python main.py</code>
<ul>
<li>to run in the background: <code>nohup python src/main.py &amp;</code></li>
<li><code>kill -9 &lt;PID&gt;</code> to stop</li>
</ul></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.env</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-filename=".env"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>PASSWORD=</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>HOST=</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>PORT=5432</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>DATABASE=</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>USER=</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>After exploring a few external web services, you will work with a web service created specifically for these practical exercises.</p>
<p>Still using your API Client, query the following endpoints:</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>GET /attack</code></label></li>
<li><label><input type="checkbox"><code>GET /attack/&lt;attack_name_or_id&gt;</code></label></li>
<li><label><input type="checkbox"><code>GET /attack?type_attack_id=&lt;id_type&gt;</code></label>
<ul>
<li>replacing <em>id_type</em> with an integer between 1 and 4</li>
</ul></li>
<li><label><input type="checkbox"><code>GET /attack?type_attack_name=&lt;type attack&gt;&amp;limit=8</code></label>
<ul>
<li>type attack: <em>special attack</em>, <em>physical attack</em>, <em>fixed damage</em> or <em>status attack</em></li>
</ul></li>
<li><label><input type="checkbox">Use parameters <em>limit</em> and <em>offset</em> to get attacks id between 11 and 15</label></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have any issues with the API Client, you can connect directly to Swagger (see instructions below) to execute requests.</p>
</div>
</div>
<p>Let’s create an attack:</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>POST /attack</code></label>
<ul>
<li>Click on <strong>Body</strong>, then <strong>application/json</strong></li>
<li>Paste the text below</li>
<li>Custom your own attack replacing attribute values</li>
<li>attack_type: <em>physical attack</em> / “special attack” / “fixed damage” / “status attack”</li>
</ul></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>application/body</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-filename="application/body"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"&lt;An awesome name&gt;"</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"attack_type"</span><span class="fu">:</span> <span class="st">"&lt;An awesome type&gt;"</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"power"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"accuracy"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"element"</span><span class="fu">:</span> <span class="st">"&lt;An awesome element&gt;"</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"&lt;An awesome description&gt;"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Check your attack has been created successfully.</label>
<ul>
<li><code>GET /attack/&lt;attack_name&gt;</code></li>
</ul></li>
</ul>
</section>
<section id="swagger" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="swagger"><span class="header-section-number">1.4</span> Swagger</h3>
<p>In your web browser, go to the endpoint <code>/docs</code>.</p>
<p>This will take you to the webservice’s swagger page. This page lists all the webservice endpoints and how to use them. Try using the interface to:</p>
<ul>
<li>modify an attack</li>
<li>delete an attack</li>
<li>display a list of Pokémon</li>
<li>add a Pokémon</li>
</ul>
<p>Further documentation is available at the <code>/redoc</code> endpoint.</p>
</section>
</section>
<section id="python-webservice" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="python-webservice"><span class="header-section-number">2</span> Python Webservice</h2>
<p>Today, the biggest consumers of web services are machines. We will see how to automate calls to a web service in Python.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Today, many web applications (e.g.&nbsp;Facebook, Netflix, Dailymotion, Uber) use what are known as “micro services” architectures.</p>
<p>Communication between their application components (e.g.&nbsp;between their human-machine interface (HMI) and their internal services) is carried out via single-purpose web services. This allows modules to be decoupled from one another, as they communicate solely via HTTP requests or event management systems. They only need to know how to communicate with one another, not the internal workings of other modules.</p>
<p>This requires thorough documentation of web services and the management of a HUGE number of applications in parallel. Amazon, Google and Facebook can afford to do this, but a small company with 10 employees cannot.</p>
</div>
</div>
<section id="requests-library" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="requests-library"><span class="header-section-number">2.1</span> Requests Library</h3>
<p>The principle remains the same as making a request manually with an API client. You will use the <a href="https://requests.readthedocs.io/en/master/" target="_blank"><strong>requests</strong></a> library so that you only have to fill in the relevant parts of your requests.</p>
<p>To make a <strong>GET</strong> request, simply do the following:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">"http://my-webservice.com"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Executing this line of code will:</p>
<ol type="1">
<li>Send the <em>GET</em> request to the server you are contacting</li>
<li>Store the result in the <em>response</em> variable</li>
</ol>
<p>This <em>response</em> variable is an object, and like any object, it has attributes and methods, for example:</p>
<ul>
<li><code>response.text</code>: the body of the result in string form, letting <em>requests</em> infer the encoding (this often works)
<ul>
<li>Problem: you have a string, and this is not the best data format to work with</li>
</ul></li>
<li><strong><code>response.json()</code></strong>: the body of the result as a dictionary.
<ul>
<li>This is what you will do most often because the JSON format is easy to manipulate</li>
</ul></li>
<li><code>response.encoding</code>: the encoding of your request (useful in case of encoding problems)</li>
<li><strong><code>response.status_code</code></strong>: the status of the request. The main ones are:</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>200</td>
<td>General return to say that everything went well</td>
</tr>
<tr class="even">
<td>201</td>
<td>Resource created successfully</td>
</tr>
<tr class="odd">
<td>202</td>
<td>Accepted, with no guarantee of the result (asynchronous system)</td>
</tr>
<tr class="even">
<td>400</td>
<td>Bad request (Syntax error)</td>
</tr>
<tr class="odd">
<td>401</td>
<td>Error, authentication required</td>
</tr>
<tr class="even">
<td>403</td>
<td>Resource prohibited (insufficient rights)</td>
</tr>
<tr class="odd">
<td>404</td>
<td>Resource not found</td>
</tr>
<tr class="even">
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr class="odd">
<td>500</td>
<td>Server-side error</td>
</tr>
<tr class="even">
<td>503</td>
<td>Service temporarily unavailable</td>
</tr>
</tbody>
</table>
<p>To summarise, the results:</p>
<ul>
<li><span class="emoji" data-emoji="white_check_mark">✅</span> <em>2xx</em> (success): the client’s request was successfully received, understood, and accepted</li>
<li><span class="emoji" data-emoji="x">❌</span> <em>4xx</em> (Client Errors): this could be due to incorrect syntax, unauthorized access, or the resource not being found</li>
<li><span class="emoji" data-emoji="x">❌</span> <em>5xx</em> (Server Errors): the server failed to fulfill a valid request</li>
</ul>
</section>
<section id="examples-of-use" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="examples-of-use"><span class="header-section-number">2.2</span> Examples of use</h3>
<p>The principle will always be the same:</p>
<ol type="1">
<li>You launch the query</li>
<li>You check if the status is OK</li>
<li>You retrieve the JSON and process the result (display, conversion to dataframe, etc.)</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset nav-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Template</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Menus-cantines</a></li></ul>
<div class="tab-content nav-pills">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">"http://my-webservice.com"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Cannot reach (HTTP </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(json.dumps(response.json(), indent<span class="op">=</span><span class="dv">2</span>))       <span class="co"># JSON Pretty print</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/menus-cantines/records?limit=20"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>req <span class="op">=</span> requests.get(url)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> req.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    raw_menus <span class="op">=</span> req.json()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> raw_menus.get(<span class="st">"results"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> records:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        menus <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(menus)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No records found."</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve data. Status code: </span><span class="sc">{</span>req<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="sc">{</span>req<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="launch-vscode" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="launch-vscode"><span class="header-section-number">2.3</span> Launch VScode</h3>
<div class="callout callout-style-default callout-important callout-titled" title="Custom VSCode service">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Custom VSCode service
</div>
</div>
<div class="callout-body-container callout-body">
<p>You <u>should not launch</u> a standard VSCode-python service, but rather a customised version.</p>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Login to a Datalab</label>
<ul>
<li><a href="https://onyxia.lab.groupe-genes.fr/" target="_blank">https://onyxia.lab.groupe-genes.fr/</a></li>
<li><a href="https://datalab.sspcloud.fr/" target="_blank">https://datalab.sspcloud.fr/</a></li>
</ul></li>
<li><label><input type="checkbox">Go to the <a href="../../doc/tp/tools.html" target="_blank">Tools page</a></label>
<ul>
<li>It explains why we are going to use a customised service</li>
</ul></li>
<li><label><input type="checkbox">Launch a <u><strong>customised</strong></u> VSCode service</label></li>
</ul>
</section>
<section id="clone-the-repository" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="clone-the-repository"><span class="header-section-number">2.4</span> Clone the repository</h3>
<ul class="task-list">
<li><label><input type="checkbox">Clone your fork of repository <em>ENSAI-2A-complement-info-TP</em></label>
<ul>
<li>refer to previous TP if you have not already created the fork</li>
</ul></li>
<li><label><input type="checkbox">Position yourself on the branch <em>tp3-base</em></label>
<ul>
<li><code>git switch tp3-base</code></li>
<li>to ensure that everyone starts at the same level</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled" title="Verify that everything is working">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Verify that everything is working
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="task-list">
<li><label><input type="checkbox">Install required packages</label></li>
<li><label><input type="checkbox">Run the unit tests for the business_object package</label>
<ul>
<li><code>pytest -v src/tests/test_business_object/</code></li>
</ul></li>
<li><label><input type="checkbox">Run the main program : <code>python src/__main__.py</code></label></li>
</ul>
</div>
</div>
</section>
<section id="my-first-queries-in-python" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="my-first-queries-in-python"><span class="header-section-number">2.5</span> My first queries in Python</h3>
<ul class="task-list">
<li><label><input type="checkbox">Edit the <em>.env</em> file to connect to the <a href="#advanced-queries">web service you just used</a></label></li>
<li><label><input type="checkbox">Open file <code>/src/client/attack_client.py</code></label></li>
<li><label><input type="checkbox">Complete the <em>get_attack(int)</em> method, which:</label>
<ul>
<li>takes an attack ID as a parameter</li>
<li>retrieves all available information about this attack</li>
<li>returns an object of type <strong>AbstractAttack</strong></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To help you, take a look at the <em>instantiate_attack()</em> method of the <strong>AttackFactory</strong> class (business_object).</p>
<p>See how this method works and use it.</p>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Create the <em>get_all_attacks()</em> method</label>
<ul>
<li>Returns the list of all available attacks in the form of a list of <strong>AbstractAttack</strong> objects</li>
</ul></li>
</ul>
</section>
<section id="more-complex-requests" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="more-complex-requests"><span class="header-section-number">2.6</span> More complex requests</h3>
<p>So far, we have focused on <strong>GET</strong> queries (simple data reading).</p>
<p>But it is possible to do others. For example, <strong>POST</strong>, <strong>PUT</strong> or <strong>DELETE</strong> queries.</p>
<p>Here is the syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> requests.post(<span class="st">"http://example.org"</span>, json <span class="op">=</span> {<span class="st">'key'</span>:<span class="st">'value'</span>})</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>put <span class="op">=</span> requests.put(<span class="st">"http://example.org"</span>, json <span class="op">=</span> {<span class="st">'key'</span>:<span class="st">'value'</span>})</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>delete <span class="op">=</span> requests.delete(<span class="st">"http://example.org"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>As you can see, syntaxes are very similar to the syntax of the <strong>GET</strong> method. We have only added data for certain requests. This is what you did earlier with the API Client. To pass parameters to your request, We recommend using this type of syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Arguments</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"http://example.org"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> {<span class="st">'accept'</span>: <span class="st">'application/json'</span>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">'key1'</span>:<span class="st">'value1'</span>, <span class="st">'key2'</span>:<span class="st">'value2'</span>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch Request</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, json <span class="op">=</span> data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Functionally, it’s the same thing, but it’s better to define the elements outside the query so you don’t get lost.</p>
</section>
<section id="advanced-requests-in-python" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="advanced-requests-in-python"><span class="header-section-number">2.7</span> Advanced requests in Python</h3>
<p>In the <code>attack_client.py</code> module, implement the following methods:</p>
<ul class="task-list">
<li><label><input type="checkbox"><em>create_attack(AbstractAttack)</em></label>
<ul>
<li>takes an <strong>AbstractAttack</strong> as a parameter</li>
<li>creates a new attack calling the web service</li>
</ul></li>
<li><label><input type="checkbox"><em>update_attack(AbstractAttack)</em></label>
<ul>
<li>takes an <strong>AbstractAttack</strong> as a parameter</li>
<li>modifies it in the web service</li>
</ul></li>
<li><label><input type="checkbox"><em>delete_attack(AbstractAttack)</em></label>
<ul>
<li>takes an <strong>AbstractAttack</strong> as a parameter</li>
<li>deletes it in the web service</li>
</ul></li>
</ul>
</section>
</section>
<section id="code-a-web-service-in-python" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="code-a-web-service-in-python"><span class="header-section-number">3</span> Code a web service in Python</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Until now, you have been using existing web services.</p>
<p>Now you are going to create your own web service.</p>
</div>
</div>
<p>With the tools available today, it is easy to create a web service yourself.</p>
<p>There are currently three market leaders for creating a REST web service in Python:</p>
<ul>
<li><a href="https://www.django-rest-framework.org/" target="_blank">Django REST</a></li>
<li><a href="https://flask-restful.readthedocs.io/en/latest/" target="_blank">FlaskRESTful</a></li>
<li><a href="https://fastapi.tiangolo.com/" target="_blank">FastAPI</a></li>
</ul>
<p>Each has its advantages and disadvantages. Django is certainly the most comprehensive but also the heaviest, while Flask and FastApi are lighter and quicker to set up. The big advantage of <strong>FastApi</strong> is the simplicity with which you can create a Swagger documentation page.</p>
<p>Here is the minimal code for a REST web service with FastAPI (<a href="https://fastapi.tiangolo.com/tutorial/first-steps/" target="_blank">official documentation</a>)</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>app.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" data-filename="app.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the web service</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an endpoint that responds to the GET method at the address "/" and returns the message "Hello World".</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> root():</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Hello World"</span>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Launching the application on port 5000</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"0.0.0.0"</span>, port<span class="op">=</span><span class="dv">5000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Calling the “/” resource of the web service will return the JSON: <code>{"message": "Hello World"}</code></p>
<p>Here is a more complete example inspired by the <a href="https://flask-restful.readthedocs.io/en/latest/quickstart.html#resourceful-routing" target="_blank">official documentation</a> (you want to create a web service to expose your <strong>todos</strong>)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">from</span> starlette <span class="im">import</span> status</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="im">import</span> uvicorn</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># On instancie le webservice</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw">class</span> Todo(BaseModel):</span>
<span id="cb9-10"><a href="#cb9-10"></a>    <span class="bu">id</span> : <span class="bu">int</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>    content : <span class="bu">str</span></span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a>todos <span class="op">=</span> {<span class="dv">1</span> : Todo(<span class="dv">1</span>,<span class="st">"Step 1 : Learn python"</span>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>        , <span class="dv">2</span> : Todo(<span class="dv">2</span>,<span class="st">"Step 2 : Work on the IT project"</span>)</span>
<span id="cb9-15"><a href="#cb9-15"></a>        , <span class="dv">3</span> : Todo(<span class="dv">3</span>,<span class="st">"Step 3 : ???"</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a>        , <span class="dv">4</span> : Todo(<span class="dv">4</span>,<span class="st">"Step 4 : Profit"</span>)}</span>
<span id="cb9-17"><a href="#cb9-17"></a></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co"># Endpoint GET /todo</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="at">@app.get</span>(<span class="st">"/todo"</span>)</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="cf">async</span> <span class="kw">def</span> get_all_todo():</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="cf">return</span> todos.values()</span>
<span id="cb9-22"><a href="#cb9-22"></a></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co"># Endpoint GET /todo/{id_doto}</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="at">@app.get</span>(<span class="st">"/todo/</span><span class="sc">{id_toto}</span><span class="st">"</span>)</span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="cf">async</span> <span class="kw">def</span> get_todo_by_id(id_toto : <span class="bu">int</span> <span class="op">=</span> Path(..., description <span class="op">=</span> <span class="st">"The `id` of the todo you want to get"</span>)):</span>
<span id="cb9-26"><a href="#cb9-26"></a>    <span class="cf">if</span> todos.get[id_toto] :</span>
<span id="cb9-27"><a href="#cb9-27"></a>        <span class="cf">return</span> todos.get[id_toto]</span>
<span id="cb9-28"><a href="#cb9-28"></a>    <span class="cf">else</span> :</span>
<span id="cb9-29"><a href="#cb9-29"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span>status.HTTP_404_NOT_FOUND)</span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co"># Endpoint POST /todo</span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="at">@app.post</span>(<span class="st">"/todo"</span>, todo, status_code<span class="op">=</span><span class="dv">201</span>)</span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="cf">async</span> <span class="kw">def</span> post_todo(todo:Todo):</span>
<span id="cb9-34"><a href="#cb9-34"></a>    <span class="cf">if</span> <span class="kw">not</span> todos.get(todo.<span class="bu">id</span>):</span>
<span id="cb9-35"><a href="#cb9-35"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span>status.HTTP_409_CONFLICT)</span>
<span id="cb9-36"><a href="#cb9-36"></a>    <span class="cf">else</span> :</span>
<span id="cb9-37"><a href="#cb9-37"></a>        todos[todo.<span class="bu">id</span>] <span class="op">=</span> todo</span>
<span id="cb9-38"><a href="#cb9-38"></a>        <span class="cf">return</span> todo</span>
<span id="cb9-39"><a href="#cb9-39"></a></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="co"># Launch the web service</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb9-42"><a href="#cb9-42"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"0.0.0.0"</span>, port<span class="op">=</span><span class="dv">5000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This code will create a web service that will respond to the following requests:</p>
<ul>
<li><code>GET host/todo</code>: returns all tasks to be done</li>
<li><code>GET host/todo/{todo_id}</code>: returns the task behind the ID in the parameter</li>
<li><code>POST host/todo/</code>: adds the task passed in the body of the request</li>
</ul>
<p>FastAPI serialises the objects you return for you. So there’s no need to format your data. However, for clarity, you can use <code>BaseModel</code> classes. These are classes that will only contain attributes that you can declare without a constructor:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Todo(BaseModel):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> : <span class="bu">int</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    content : <span class="bu">str</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These classes can be used as output from your web service, as well as input (line 33). FastApi will perform a series of checks on the variable types and return an error to the client if their request is not formatted correctly.</p>
<p>Basically, a web service is an application like any other, but instead of having a graphical interface as we humans are used to, the interface is an HTTP interface that will accept requests and send results. Thus, the sequence diagram of the different layers that will be involved in a GET request to retrieve a resource will look like this. Let’s go back to the 3-layer model we saw in class.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">sequenceDiagram
    participant U as User
    participant R as Webservice
    participant S as Service
    participant D as DAO
    participant B as Database
    U -&gt;&gt; R: HTTP request
    R -&gt;&gt; S: get_by_id()
    S -&gt;&gt; D: find_by_id()
    D -&gt;&gt; B: SQL query (psycopg)
    B -&gt;&gt; D: SQL cursor (psycopg)
    D -&gt;&gt; S: business object instance
    S -&gt;&gt; R: business object instance
    Note over S,R: the object is potentially altered
    R -&gt;&gt; U: HTTP response
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<section id="my-first-web-service" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="my-first-web-service"><span class="header-section-number">3.1</span> My first web service</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The web service you will create will be deployed on a specific url. To find this url:</p>
<ul>
<li>In the datalab &gt; My services</li>
<li>VScode-python &gt; Open &gt; your will find a link</li>
</ul>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Open the <code>app.py</code> file</label></li>
<li><label><input type="checkbox">Change the launch port to match the one opened on the datalab</label></li>
<li><label><input type="checkbox">Run this file</label></li>
<li><label><input type="checkbox">Test the following requests:</label>
<ul>
<li><code>GET hello</code></li>
<li><code>GET hello/everybody</code></li>
</ul></li>
<li><label><input type="checkbox">Stop the web service</label>
<ul>
<li>Click in the VSCode terminal, then press CTRL + C</li>
</ul></li>
</ul>
<p>Using the list of characters defined in the <em>app.py</em> file, add the following endpoints:</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>GET character</code>: will return a JSON containing a list of characters</label></li>
<li><label><input type="checkbox"><code>PUT character/{id}</code>, which will modify the name of the character at index <code>{id}</code> from a body</label></li>
<li><label><input type="checkbox"><code>DELETE character/{id}</code>, which will delete the item at index <code>{id}</code></label></li>
</ul>
<p>To test endpoints requiring a JSON body, you can use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"nom"</span><span class="fu">:</span><span class="st">"Agneta"</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">30</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="end-of-the-lab" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="end-of-the-lab">End of the Lab</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="task-list">
<li><label><input type="checkbox">Push your code to GitHub</label>
<ul>
<li>if your VSCode service dies, your code will not be lost</li>
<li>on Datalabs, there is no guarantee of the lifespan of your services</li>
</ul></li>
<li><label><input type="checkbox">Pause or delete your datalab services</label>
<ul>
<li>to free up reserved resources</li>
</ul></li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ludo2ne\.github\.io\/ENSAI-2A-Projet-info\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Website built with <a href="https://quarto.org/" class="external" target="_blank">Quarto</a> <br> <a href="https://github.com/ludo2ne/ENSAI-2A-Projet-info" class="external" target="_blank">Code source</a></p>
</div>
  </div>
</footer>




</body></html>