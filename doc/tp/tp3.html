<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rémi Pépin, Ludovic Deneuville">
<meta name="description" content="TP 3">

<title>Webservices et formats de données – Projet info 2A</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Projet info 2A</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projet" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projet</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projet">    
        <li>
    <a class="dropdown-item" href="../../doc/projet/presentation-tuteurs.html">
 <span class="dropdown-text">Présentation pour les tuteurs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/presentation-eleves.html">
 <span class="dropdown-text">Présentation aux élèves</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/notice-eleves.html">
 <span class="dropdown-text">Notice élèves</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ludo2ne/ENSAI-2A-projet-info-template">
 <span class="dropdown-text">Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/projet/sujets-2024-2025.html">
 <span class="dropdown-text">Sujets 2024-2025</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="../../doc/cours/intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/outils-dev.html">
 <span class="dropdown-text">Outils de développement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ludo2ne.github.io/Git-tuto/doc/presentation.html" target="_blank">
 <span class="dropdown-text">Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/analyse-fonctionnelle.html">
 <span class="dropdown-text">Analyse fonctionnelle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/poo-avancee.html">
 <span class="dropdown-text">POO Avancée</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/tests-unitaires.html">
 <span class="dropdown-text">Tests unitaires</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/webservices.html">
 <span class="dropdown-text">Webservices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/cours/dao-securite.html">
 <span class="dropdown-text">DAO et Sécurité</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tp">    
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp1.html">
 <span class="dropdown-text">TP 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp2.html">
 <span class="dropdown-text">TP 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp3.html">
 <span class="dropdown-text">TP 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/tp/tp4.html">
 <span class="dropdown-text">TP 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ludo2ne/ENSAI-2A-Projet-info" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#avant-de-commencer" id="toc-avant-de-commencer" class="nav-link active" data-scroll-target="#avant-de-commencer">Avant de commencer</a></li>
  <li><a href="#appeler-un-webservice-à-la-main" id="toc-appeler-un-webservice-à-la-main" class="nav-link" data-scroll-target="#appeler-un-webservice-à-la-main"><span class="header-section-number">1</span> Appeler un webservice à la main</a>
  <ul class="collapse">
  <li><a href="#webservices" id="toc-webservices" class="nav-link" data-scroll-target="#webservices"><span class="header-section-number">1.1</span> Webservices</a></li>
  <li><a href="#premières-requêtes-get" id="toc-premières-requêtes-get" class="nav-link" data-scroll-target="#premières-requêtes-get"><span class="header-section-number">1.2</span> Premières requêtes GET</a></li>
  <li><a href="#requêtes-avancées" id="toc-requêtes-avancées" class="nav-link" data-scroll-target="#requêtes-avancées"><span class="header-section-number">1.3</span> Requêtes avancées</a></li>
  <li><a href="#swagger" id="toc-swagger" class="nav-link" data-scroll-target="#swagger"><span class="header-section-number">1.4</span> Swagger</a></li>
  </ul></li>
  <li><a href="#webservice-en-python" id="toc-webservice-en-python" class="nav-link" data-scroll-target="#webservice-en-python"><span class="header-section-number">2</span> Webservice en Python</a>
  <ul class="collapse">
  <li><a href="#la-bibliothèque-requests" id="toc-la-bibliothèque-requests" class="nav-link" data-scroll-target="#la-bibliothèque-requests"><span class="header-section-number">2.1</span> La bibliothèque requests</a></li>
  <li><a href="#exemples-dutilisation" id="toc-exemples-dutilisation" class="nav-link" data-scroll-target="#exemples-dutilisation"><span class="header-section-number">2.2</span> Exemples d’utilisation</a></li>
  <li><a href="#mise-à-jour-de-votre-dépôt-git" id="toc-mise-à-jour-de-votre-dépôt-git" class="nav-link" data-scroll-target="#mise-à-jour-de-votre-dépôt-git"><span class="header-section-number">2.3</span> Mise à jour de votre dépôt git</a></li>
  <li><a href="#mes-premières-requêtes-en-python" id="toc-mes-premières-requêtes-en-python" class="nav-link" data-scroll-target="#mes-premières-requêtes-en-python"><span class="header-section-number">2.4</span> Mes premières requêtes en Python</a></li>
  <li><a href="#les-requêtes-plus-complexes" id="toc-les-requêtes-plus-complexes" class="nav-link" data-scroll-target="#les-requêtes-plus-complexes"><span class="header-section-number">2.5</span> Les requêtes plus complexes</a></li>
  <li><a href="#requêtes-avancées-en-python" id="toc-requêtes-avancées-en-python" class="nav-link" data-scroll-target="#requêtes-avancées-en-python"><span class="header-section-number">2.6</span> Requêtes avancées en python</a></li>
  </ul></li>
  <li><a href="#codez-un-webservice-en-python" id="toc-codez-un-webservice-en-python" class="nav-link" data-scroll-target="#codez-un-webservice-en-python"><span class="header-section-number">3</span> Codez un webservice en Python</a>
  <ul class="collapse">
  <li><a href="#mon-premier-webservice" id="toc-mon-premier-webservice" class="nav-link" data-scroll-target="#mon-premier-webservice"><span class="header-section-number">3.1</span> Mon premier webservice</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Webservices et formats de données</h1>
</div>

<div>
  <div class="description">
    TP 3
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rémi Pépin, Ludovic Deneuville </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="avant-de-commencer" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="avant-de-commencer">Avant de commencer</h2>
<p><span class="emoji" data-emoji="scream">😱</span> Comme vous pouvez le constater, le sujet de ce TP est lui aussi long. Cela ne doit pas vous effrayer.</p>
<p>Il mélange explications complètes et manipulations pour être au maximum autosuffisant.</p>
<p><strong>Vous n’allez surement pas terminer le sujet, ce n’est pas grave. Il est là pour vous aider lors du projet informatique.</strong></p>
<div class="callout callout-style-default callout-note callout-titled" title="Objectifs">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objectifs
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dans ce TP vous allez :</p>
<ul>
<li>Faire des appels à un webservice à la main avec <em>Insomnia</em></li>
<li>Faire des appels à un webservice avec la bibliothèque python <em>requests</em></li>
<li>Découvrir la page swagger d’un webservice</li>
<li>Manipuler différents formats de données</li>
<li>Créer un webservice avec le framework python <em>fastAPI</em></li>
</ul>
</div>
</div>
</section>
<section id="appeler-un-webservice-à-la-main" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="appeler-un-webservice-à-la-main"><span class="header-section-number">1</span> Appeler un webservice à la main</h2>
<p>La première partie de ce TP ne nécessite pas d’écrire du code, mais seulement de faire des requêtes à un webservice en utilisant le logiciel <a href="https://insomnia.rest/" target="_blank">Insomnia</a> installé sur votre machine.</p>
<section id="webservices" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="webservices"><span class="header-section-number">1.1</span> Webservices</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Webservice</strong> : le terme webservice est un terme vaste et il serait compliqué d’en donner une définition courte (<a href="https://en.wikipedia.org/wiki/Web_service" target="_blank">article wikipedia</a>).</p>
<p>Dans le cadre du projet un webservice désigne une application accessible via le protocole HTTP (<strong>H</strong>yper<strong>T</strong>ext <strong>T</strong>ransfer <strong>P</strong>rotocol) qui respecte généralement l’architecture REST (<strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer).</p>
<p>Mais il en existe d’autre comme SOAP (<strong>S</strong>imple <strong>O</strong>bjet- <strong>A</strong>ccess <strong>P</strong>rotocol) ou RPC (<strong>R</strong>emote <strong>P</strong>rocedure <strong>C</strong>all)</p>
</div>
</div>
<p>En d’autres termes, un webservice est une application accessible via le web que l’on va pouvoir <strong>requêter</strong> soit :</p>
<ul>
<li>pour obtenir des <strong>ressources</strong></li>
<li>pour <strong>modifier</strong> les ressources accessibles.</li>
</ul>
<p>Un webservice peut seulement avoir pour but d’être une <strong>point d’accès unique et normalisé</strong> à des données (comme une interface à une base de données), mais il peut également être une <strong>manière de contrôler un système d’informations</strong> (lancer des travaux, les mettre en attente, récupérer des résultats…)</p>
<p>Les webservices utilisent le protocole HTTP qui est le protocole du web (et pas d’internet). C’est celui que vous utilisez sans le savoir avec votre navigateur web. Requêter un webservice se fait presque comme requêter une page web.</p>
<p>Pour cela il vous faut :</p>
<ul>
<li>l’adresse de la ressource, son <em>Uniforme Resource Identifier</em> (URI)
<ul>
<li>c’est une notion plus générale que les <em>Uniforme Resource Locator</em> (URL)</li>
</ul></li>
<li>une méthode (GET, POST, PUT, DELETE, <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" target="_blank">liste des méthodes</a>)</li>
<li>et potentiellement des données</li>
</ul>
</section>
<section id="premières-requêtes-get" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="premières-requêtes-get"><span class="header-section-number">1.2</span> Premières requêtes GET</h3>
<ul class="task-list">
<li><label><input type="checkbox">Lancez le programme <strong>Insomnia</strong> (recherchez dans le menu démarrer)</label></li>
<li><label><input type="checkbox">Créez une collection de requête</label>
<ul>
<li>bouton <strong>Create</strong> à droite</li>
<li>puis cliquez sur votre collection</li>
</ul></li>
<li><label><input type="checkbox">Créez une nouvelle requête</label>
<ul>
<li>en appuyant sur <strong>CTRL+N</strong></li>
<li>donnez lui un nom</li>
<li>vérifiez que c’est bien une requête de type <strong>GET</strong></li>
</ul></li>
</ul>
<p>Dans la barre d’adresse, testez les requêtes des webservices ci-dessous :</p>
<ul>
<li>Regardez la réponse dans la partie droite de votre écran</li>
<li>Quelles sont les similarités entre les réponses ?</li>
</ul>
<section id="carbon-intensity" class="level4" data-number="1.2.1">
<h4 data-number="1.2.1" class="anchored" data-anchor-id="carbon-intensity"><span class="header-section-number">1.2.1</span> Carbon intensity</h4>
<p>Webservice sur les émissions carbone du Royaume-Uni</p>
<ul>
<li><a href="https://carbon-intensity.github.io/api-definitions/#carbon-intensity-api-v2-0-0" target="_blank">Documentation</a>
<ul>
<li><a href="https://carbon-intensity.github.io/api-definitions/#intensity" target="_blank">Les endpoints</a></li>
<li><a href="https://carbon-intensity.github.io/api-definitions/#schemas" target="_blank">Les schémas</a></li>
</ul></li>
</ul>
<p>Requêtes à tester :</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>api.carbonintensity.org.uk/intensity</code></label></li>
<li><label><input type="checkbox"><code>api.carbonintensity.org.uk/intensity/date/{date}</code></label>
<ul>
<li>en remplaçant <em>{date}</em> par la date de votre choix au format <em>YYYY-MM-DD</em></li>
</ul></li>
</ul>
</section>
<section id="rennes-métropole-en-accès-libre" class="level4" data-number="1.2.2">
<h4 data-number="1.2.2" class="anchored" data-anchor-id="rennes-métropole-en-accès-libre"><span class="header-section-number">1.2.2</span> Rennes Métropole en accès libre</h4>
<p>Webservice <a href="https://data.rennesmetropole.fr/explore/" target="_blank">Rennes Métropole en accès libre</a></p>
<p>Récupérez les données de divers datasets :</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/&lt;dataset_id&gt;/records</code></label>
<ul>
<li>Remplacez <code>&lt;dataset_id&gt;</code> par une des valeurs ci-après</li>
</ul></li>
<li><label><input type="checkbox"><em>menus-cantines</em></label></li>
<li><label><input type="checkbox"><em>eco-counter-data</em></label></li>
<li><label><input type="checkbox"><em>resultats-des-elections-municipales-2020-a-acigne</em></label></li>
<li><label><input type="checkbox">Ajouter à la fin de l’URI le paramètre <em>rows</em></label>
<ul>
<li>pour faire varier le nombre de lignes que vous recevez</li>
<li>ajouter simplement <code>&amp;rows=X</code> avec X le nombre de lignes</li>
</ul></li>
</ul>
</section>
<section id="webservice-de-votre-projet" class="level4" data-number="1.2.3">
<h4 data-number="1.2.3" class="anchored" data-anchor-id="webservice-de-votre-projet"><span class="header-section-number">1.2.3</span> Webservice de votre projet</h4>
<ul class="task-list">
<li><label><input type="checkbox">Explorez quelques méthodes utiles du webservice de votre projet informatique (voyez cela avec votre tuteur).</label></li>
</ul>
</section>
</section>
<section id="requêtes-avancées" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="requêtes-avancées"><span class="header-section-number">1.3</span> Requêtes avancées</h3>
<p>Après avoir exploré quelques webservices externes, vous allez travaillez avec un webservice hébergé à l’ENSAI spécialement créé pour ces TP.</p>
<p>Toujours avec <strong>Insomnia</strong> :</p>
<ul class="task-list">
<li><label><input type="checkbox">Faites une requête avec la méthode <strong>GET</strong> sur la ressource suivante. Qu’obtenez-vous ?</label>
<ul>
<li><code>web-services.domensai.ecole/attack</code></li>
</ul></li>
<li><label><input type="checkbox">Faites une requête avec la méthode <strong>GET</strong> sur la ressource suivante. Qu’obtenez-vous ?</label>
<ul>
<li><code>web-services.domensai.ecole/attack/{identifier}</code></li>
<li>en remplaçant <em>{identifier}</em> par le nom ou l’id d’une attaque que vous venez de récupérer</li>
</ul></li>
<li><label><input type="checkbox">Faites une requête avec la méthode <strong>GET</strong> sur la ressource suivante. Qu’obtenez-vous ?</label>
<ul>
<li><code>web-services.domensai.ecole/attack?type_attack_id={id_type}</code></li>
<li>en remplaçant <em>{id_type}</em> par un entier entre 1 et 4.</li>
</ul></li>
<li><label><input type="checkbox">Faites une requête avec la méthode <strong>GET</strong> sur la ressource suivante</label>
<ul>
<li><code>web-services.domensai.ecole/attack?type_attack_name={type attack}</code></li>
<li>en remplaçant <em>{type attack}</em> par <em>special attack</em> ou <em>physical attack</em> ou <em>fixed damage</em> ou <em>status attack</em></li>
</ul></li>
<li><label><input type="checkbox">Faites une requête de type <strong>POST</strong> sur la ressource suivante</label>
<ul>
<li><code>web-services.domensai.ecole/attack</code></li>
<li>Cliquez sur <strong>Body</strong>, puis <strong>JSON</strong>, coller le texte ci-dessous, puis remplacez les valeurs des attributs pour créer votre propre attaque</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"An awesome name"</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"attack_type"</span><span class="fu">:</span> <span class="st">"physical attack"</span><span class="er">/</span><span class="st">"physical attack"</span><span class="er">/</span><span class="st">"fixed damage"</span><span class="er">/</span><span class="st">"status attack"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"power"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"accuracy"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"element"</span><span class="fu">:</span> <span class="st">"An awesome element"</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"An awesome description"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><label><input type="checkbox">Faites une requête avec la méthode <strong>GET</strong> sur la ressource suivante</label>
<ul>
<li><code>web-services.domensai.ecole/attack/{identifier}</code></li>
<li>en remplaçant <em>{identifier}</em> par le nom ou l’id de l’attaque que vous venez de créer</li>
</ul></li>
</ul>
</section>
<section id="swagger" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="swagger"><span class="header-section-number">1.4</span> Swagger</h3>
<p>Dans votre navigateur web allez sur la page <a href="http://web-services.domensai.ecole/docs" target="_blank">http://web-services.domensai.ecole/docs</a>.</p>
<p>Cela vous amène sur la page swagger du webservice. Cette page recense tous les endpoints du webservice, et comment les utiliser. Essayez via l’interface de :</p>
<ul>
<li>modifier une attaque</li>
<li>supprimer une attaque</li>
<li>afficher une liste de pokémon</li>
<li>ajouter un pokémon</li>
</ul>
</section>
</section>
<section id="webservice-en-python" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="webservice-en-python"><span class="header-section-number">2</span> Webservice en Python</h2>
<p>Aujourd’hui, les plus grands consommateurs de webservices sont les machines. Nous allons voir comment automatiser des appels à un webservice en Python.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Aujourd’hui beaucoup d’applications web (par exemple Facebook, Netflix, Dailymotion, Uber) utilisent ce que l’on appelle des architectures “micro services”.</p>
<p>Les échanges entre leurs composants applicatifs (par exemple entre leur interface homme machine (IHM) et leurs services internes) se font via des webservices à but unique. Cela permet d’avoir des modules découplés les uns des autres car ils communiquent uniquement via des requêtes HTTP, ou avec des systèmes de gestion d’évènements. Ils ont seulement à savoir comment ils doivent communiquer les uns avec les autres et pas le fonctionnement interne des autres modules.</p>
<p>Cela demande de bien documenter ses webservices et de gérer ÉNORMÉMENT d’applications en parallèle. Amazon, Google, Facebook peuvent se le permettre, par contre une petite entreprise de 10 employés non.</p>
</div>
</div>
<section id="la-bibliothèque-requests" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="la-bibliothèque-requests"><span class="header-section-number">2.1</span> La bibliothèque requests</h3>
<p>Le principe va rester le même que faire une requête à la main avec <em>Insomnia</em>. Vous allez utiliser la bibliothèque <a href="https://requests.readthedocs.io/en/master/" target="_blank"><strong>requests</strong></a> pour avoir seulement à remplir les parties intéressantes de vos requêtes.</p>
<p>Pour faire une requête <strong>GET</strong> vous allez simplement faire :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">"http://mon-webservice.com"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Exécuter cette ligne de code va :</p>
<ol type="1">
<li>Envoyer la requête <em>GET</em> au serveur que vous contactez</li>
<li>Stockez le résultat dans la variable <em>response</em></li>
</ol>
<p>Cette variable <em>response</em> est un objet, et comme tout objet elle a des attributs et des méthodes, par exemple :</p>
<ul>
<li><code>response.text</code> : le corps du résultat sous forme de string en laissant <em>requests</em> inférer l’encodage (cela fonctionne souvent)
<ul>
<li>Problème : vous avez un string, et ce n’est pas le meilleur format de données à manipuler</li>
</ul></li>
<li><strong><code>response.json()</code></strong> : le corps du résultat comme un dictionnaire.
<ul>
<li>C’est ce que vous allez faire le plus souvent car le format json est un format simple à manipuler</li>
</ul></li>
<li><code>response.encoding</code> : l’encoding de votre requête (utile en cas de problème d’encoding)</li>
<li><strong><code>response.status_code</code></strong> : le statut de la requête. les principaux sont :
<ul>
<li>200 : retour général pour dire que tout c’est bien passé</li>
<li>201 : ressource créée avec succès</li>
<li>202 : requête acceptée, sans garantie du résultat (par exemple dans un système asynchrone)</li>
<li>400 : erreur de syntaxe dans la requête</li>
<li>401 : erreur, une authentification est nécessaire</li>
<li>403 : la ressource est interdite (droits insuffisants)</li>
<li>404 : ressource non trouvée</li>
<li>405 : une mauvaise méthode http a été utilisée</li>
<li>500 : erreur côté serveur</li>
<li>503 : service temporairement indisponible</li>
</ul></li>
</ul>
<p>Pour résumer, les résultats :</p>
<ul>
<li><em>2xx</em> indiquent un succès</li>
<li>un résultat <em>4xx</em> ou <em>5xx</em> un problème</li>
</ul>
</section>
<section id="exemples-dutilisation" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="exemples-dutilisation"><span class="header-section-number">2.2</span> Exemples d’utilisation</h3>
<p>Le principe sera toujours le même :</p>
<ol type="1">
<li>Vous lancez la requête</li>
<li>Vous vérifiez si le statut est OK</li>
<li>Vous récupérez le json et traitez le résultat (affichage, convertion en dataframe…)</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset nav-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Modèle</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Menus-cantines</a></li></ul>
<div class="tab-content nav-pills">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">"http://mon-webservice.com"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Cannot reach (HTTP </span><span class="sc">{}</span><span class="st">): </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(response.status_code, response.text)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:    </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(json.dumps(response.json(), indent<span class="op">=</span><span class="dv">2</span>))       <span class="co"># JSON Pretty print</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/menus-cantines/records?limit=20"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>req <span class="op">=</span> requests.get(url)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> req.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    raw_menus <span class="op">=</span> req.json()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> raw_menus.get(<span class="st">"results"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> records:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        menus <span class="op">=</span> pd.DataFrame(records)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(menus)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No records found."</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve data. Status code: </span><span class="sc">{</span>req<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="mise-à-jour-de-votre-dépôt-git" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="mise-à-jour-de-votre-dépôt-git"><span class="header-section-number">2.3</span> Mise à jour de votre dépôt git</h3>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si vous n’avez pas le dépôt sur votre machine, créez un clone en suivant la section <em>Clone du dépôt</em> du TP2.</p>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Ouvrez <strong>Visual Studio Code</strong></label></li>
<li><label><input type="checkbox">Ouvrez votre dépôt local</label>
<ul>
<li>File &gt; Open Folder</li>
<li>Allez dans le dossier <code>P:\Cours2A\UE3-Complements-info\TP2</code></li>
<li>Cliquez <u>une seule fois</u> sur <span class="emoji" data-emoji="file_folder">📁</span> ENSAI-2A-complement-info-TP</li>
<li>Puis sur le bouton <span class="grey-button">Sélectionner un dossier</span></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul class="task-list">
<li><label><input type="checkbox">Vérifiez que le dossier parent dans l’Explorer VS Code est <em>ENSAI-2A-complement-info-TP</em></label>
<ul>
<li>L’Explorer, à gauche, permet d’explorer l’arborsence des fichiers et dossiers</li>
</ul></li>
</ul>
<p><span class="emoji" data-emoji="warning">⚠️</span> Si le dossier parent n’est pas le bon, recommencez l’<em>Open Folder</em> où vous aurez de gros soucis par la suite !!!</p>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Ouvrez le <em>Git Bash</em> intégré dans VS Code</label>
<ul>
<li>Terminal &gt; New Terminal (ou CTRL + ù)</li>
<li>Passez sur la branche du TP3 et mettez-là à jour
<ul>
<li>si vous ne l’avez pas fait à la fin du dernier TP, commencer par un <em>add</em> et un <em>commit</em></li>
<li><code>git checkout tp3-base</code></li>
<li><code>git pull</code></li>
</ul></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour pour vérifier que tout fonctionne :</p>
<ul class="task-list">
<li><label><input type="checkbox">lancez les tests unitaires du package business_object</label>
<ul>
<li>dans le terminal : <code>python -m pytest -v src/tests/test_business_object/</code></li>
</ul></li>
<li><label><input type="checkbox">lancez le main : <code>python src/__main__.py</code></label></li>
</ul>
<p>S’il vous manque des packages, suivez les instructions du README.</p>
</div>
</div>
</section>
<section id="mes-premières-requêtes-en-python" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="mes-premières-requêtes-en-python"><span class="header-section-number">2.4</span> Mes premières requêtes en Python</h3>
<ul class="task-list">
<li><label><input type="checkbox">Ouvrez le fichier <code>/src/client/attack_client.py</code></label></li>
<li><label><input type="checkbox">Complétez la méthode <em>get_attack(int)</em> qui :</label>
<ul>
<li>prend en paramètre un id d’attaque</li>
<li>va chercher toutes les informations disponibles sur cette attaque</li>
<li>retourne un objet de type <strong>AbstractAttack</strong></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour vous aider, observez la méthode <em>instantiate_attack()</em> de la classe <strong>AttackFactory</strong> (business_object).</p>
<p>Regardez le fonctionnement de cette méthode et utilisez la.</p>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Créez la méthode <em>get_all_attacks()</em></label>
<ul>
<li>retourne la liste de tous les attaques disponibles sous la forme d’une liste d’objets <strong>AbstractAttack</strong></li>
</ul></li>
<li><label><input type="checkbox">Vérifiez que vos 2 méthodes fonctionnent</label>
<ul>
<li>Lancez les tests unitaitres du package <em>test_client</em></li>
</ul></li>
</ul>
</section>
<section id="les-requêtes-plus-complexes" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="les-requêtes-plus-complexes"><span class="header-section-number">2.5</span> Les requêtes plus complexes</h3>
<p>Pour le moment nous nous sommes concentrés sur les requêtes <strong>GET</strong> (simple lecture des données).</p>
<p>Mais il est bien sûr possible d’en faire d’autre. Par exemple pour les requêtes <strong>POST</strong>, <strong>PUT</strong> ou <strong>DELETE</strong>. Voici la syntaxe :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> requests.post(<span class="st">"http://example.org"</span>, json <span class="op">=</span> {<span class="st">'key'</span>:<span class="st">'value'</span>})</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>put <span class="op">=</span> requests.put(<span class="st">"http://example.org"</span>, json <span class="op">=</span> {<span class="st">'key'</span>:<span class="st">'value'</span>})</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>delete <span class="op">=</span> requests.delete(<span class="st">"http://example.org"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Comme vous le voyez, les syntaxes sont très proches de la syntaxe de la méthode <strong>GET</strong>. Nous avons seulement ajouté pour certaines requêtes des données. C’est ce que vous avez fait plus tôt avec Insomnia. Pour passer des paramètres à votre requête je vous conseille néanmoins de préférer ce genre de syntaxe :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"http://example.org"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">'key'</span>:<span class="st">'value'</span>}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> requests.post(url, json <span class="op">=</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Fonctionnellement, c’est la même chose, mais il vaut mieux définir les éléments hors de la requête pour ne pas se perdre.</p>
<p>Il est également possible de passer des entêtes http en ajoutant l’attribut <code>headers</code> à la fonction utilisée.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> {<span class="st">'accept'</span>: <span class="st">'application/xml'</span>}</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>requests.get(<span class="st">'http://example.org'</span>, headers<span class="op">=</span>headers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="requêtes-avancées-en-python" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="requêtes-avancées-en-python"><span class="header-section-number">2.6</span> Requêtes avancées en python</h3>
<p>Dans le module <code>attack_client.py</code> implémentez les méthodes suivantes :</p>
<ul class="task-list">
<li><label><input type="checkbox"><em>create_attack(AbstractAttack)</em></label>
<ul>
<li>prend une <strong>AbstractAttack</strong> en paramètre</li>
<li>crée une nouvelle ressource dans notre webservice</li>
</ul></li>
<li><label><input type="checkbox"><em>update_attack(AbstractAttack)</em></label>
<ul>
<li>prend une <strong>AbstractAttack</strong> en paramètre</li>
<li>modifie la ressource associée dans notre webservice</li>
</ul></li>
<li><label><input type="checkbox"><em>delete_attack(AbstractAttack)</em></label>
<ul>
<li>prend une <strong>AbstractAttack</strong> en paramètre</li>
<li>supprime la ressource associée dans notre webservice</li>
</ul></li>
<li><label><input type="checkbox">Testez vos méthodes</label></li>
</ul>
</section>
</section>
<section id="codez-un-webservice-en-python" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="codez-un-webservice-en-python"><span class="header-section-number">3</span> Codez un webservice en Python</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Jusqu’à maintenant vous avez utilisé des webservices existants. Maintenant vous allez créer votre propre webservice.</p>
</div>
</div>
<p>Avec les outils à disposition aujourd’hui, il est facile de faire un webservice soit même.</p>
<p>Il y a trois leaders sur le marché actuellement pour faire un webservice REST en Python :</p>
<ul>
<li><a href="https://www.django-rest-framework.org/" target="_blank">Django REST</a></li>
<li><a href="https://flask-restful.readthedocs.io/en/latest/" target="_blank">FlaskRESTful</a></li>
<li><a href="https://fastapi.tiangolo.com/" target="_blank">FastAPI</a></li>
</ul>
<p>Chacun à ses <a href="https://www.section.io/engineering-education/choosing-between-django-flask-and-fastapi/" target="_blank">avantages et inconvénients</a>. Django est sûrement le plus complet mais le plus lourd, Flask et FastApi sont plus légers et rapides à mettre en place. Le gros avantage de <strong>FastApi</strong> est la simplicité pour créer une page swagger de documentation.</p>
<p>Voici le code minimal d’un webservice REST avec FastAPI (<a href="https://fastapi.tiangolo.com/tutorial/first-steps/" target="_blank">documentation officielle</a>)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On instancie le webservice</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'un enpoint qui répond à la méthode GET à l'adresse "/" qui va retourne le message "Hello World"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> root():</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Hello World"</span>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Lancement de l'application sur le le port 80</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"0.0.0.0"</span>, port<span class="op">=</span><span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Appeler la ressource “/” du webservice va retourner le json : <code>{"message": "Hello World"}</code></p>
<p>Voici un exemple plus complet inspiré de la <a href="https://flask-restful.readthedocs.io/en/latest/quickstart.html#resourceful-routing" target="_blank">documentation officielle</a> (vous voulez créer un webservice pour exposer vos <strong>todos</strong>)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">from</span> starlette <span class="im">import</span> status</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="im">import</span> uvicorn</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># On instancie le webservice</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw">class</span> Todo(BaseModel):</span>
<span id="cb9-10"><a href="#cb9-10"></a>    <span class="bu">id</span> : <span class="bu">int</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>    content : <span class="bu">str</span></span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a>todos <span class="op">=</span> {<span class="dv">1</span> : Todo(<span class="dv">1</span>,<span class="st">"Step 1 : Learn python"</span>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>        , <span class="dv">2</span> : Todo(<span class="dv">2</span>,<span class="st">"Step 2 : Work on the IT project"</span>)</span>
<span id="cb9-15"><a href="#cb9-15"></a>        , <span class="dv">3</span> : Todo(<span class="dv">3</span>,<span class="st">"Step 3 : ???"</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a>        , <span class="dv">4</span> : Todo(<span class="dv">4</span>,<span class="st">"Step 4 : Profit"</span>)}</span>
<span id="cb9-17"><a href="#cb9-17"></a></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co"># Définition du endpoint get /todo</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="at">@app.get</span>(<span class="st">"/todo"</span>)</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="cf">async</span> <span class="kw">def</span> get_all_todo():</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="cf">return</span> todos.values()</span>
<span id="cb9-22"><a href="#cb9-22"></a></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co"># Définition du endpoint get /todo/{id_doto}</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="at">@app.get</span>(<span class="st">"/todo/</span><span class="sc">{id_toto}</span><span class="st">"</span>)</span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="cf">async</span> <span class="kw">def</span> get_todo_by_id(id_toto : <span class="bu">int</span> <span class="op">=</span> Path(..., description <span class="op">=</span> <span class="st">"The `id` of the todo you want to get"</span>)):</span>
<span id="cb9-26"><a href="#cb9-26"></a>    <span class="cf">if</span> todos.get[id_toto] :</span>
<span id="cb9-27"><a href="#cb9-27"></a>        <span class="cf">return</span> todos.get[id_toto]</span>
<span id="cb9-28"><a href="#cb9-28"></a>    <span class="cf">else</span> :</span>
<span id="cb9-29"><a href="#cb9-29"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span>status.HTTP_404_NOT_FOUND)</span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co"># Définition du endpoint post /todo</span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="at">@app.post</span>(<span class="st">"/todo"</span>, todo, status_code<span class="op">=</span><span class="dv">201</span>)</span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="cf">async</span> <span class="kw">def</span> post_todo(todo:Todo):</span>
<span id="cb9-34"><a href="#cb9-34"></a>    <span class="cf">if</span> <span class="kw">not</span> todos.get(todo.<span class="bu">id</span>):</span>
<span id="cb9-35"><a href="#cb9-35"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span>status.HTTP_409_CONFLICT)</span>
<span id="cb9-36"><a href="#cb9-36"></a>    <span class="cf">else</span> :</span>
<span id="cb9-37"><a href="#cb9-37"></a>        todos[todo.<span class="bu">id</span>] <span class="op">=</span> todo</span>
<span id="cb9-38"><a href="#cb9-38"></a>        <span class="cf">return</span> todo</span>
<span id="cb9-39"><a href="#cb9-39"></a></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="co"># Lancement de l'application sur le le port 8XXX avec XXX les 3 derniers numéros de votre id</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb9-42"><a href="#cb9-42"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"0.0.0.0"</span>, port<span class="op">=</span><span class="dv">8</span><span class="er">XXX</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ce code va créer un web service qui va répondre aux requêtes suivantes :</p>
<ul>
<li><code>GET host/todo</code> : retourne toutes les tâches à faire</li>
<li><code>GET host/todo/{todo_id}</code> : retourne la tâche derrière l’id en paramètre</li>
<li><code>POST host/todo/</code> : ajoute la tâche passée en corps de la rêquete</li>
</ul>
<p>FastAPI sérialise pour vous les objets que vous retournez. Donc pas besoin de mettre en forme vos données. Néanmoins, pour plus de clarté, vous pouvez utiliser des classes <code>BaseModel</code>. Ce sont des classes qui ne vont contenir que des attributs que vous pouvez déclarer sans constructeur :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Todo(BaseModel):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> : <span class="bu">int</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    content : <span class="bu">str</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ces classes peuvent être utilisées en sortie de votre webservice, comme en entrée (ligne 33). FastApi va faire pour vous tout une série de contrôle sur les types des variables et renvoyer une erreur au client si sa requête n’est pas bien formatée.</p>
<p>Fondamentalement un webservice est une application comme les autres, mais au lieu d’avoir une interface graphique comme on en a l’habitude en tant qu’humain, l’interface est une interface HTTP qui va accepter des requêtes et envoyer des résultats. Ainsi le diagramme de séquence des différentes couches qui vont être impliquées dans une requête <strong>GET</strong> pour récupérer une ressource va ressembler à cela nous reprenons le modèle 3 couches vu en cours.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">sequenceDiagram
    participant U as User
    participant R as Webservice
    participant S as Service
    participant D as DAO
    participant B as Base de données
    U -&gt;&gt; R : HTTP requête
    R -&gt;&gt; S : get_by_id()
    S -&gt;&gt; D : find_by_id()
    D -&gt;&gt; B : requête SQL (psycopg)
    B -&gt;&gt; D : curseur SQL (psycopg)
    D -&gt;&gt; S : instance objet metier
    S -&gt;&gt; R : instance objet metier
    Note over S,R: l'objet est potentiellement altéré
    R -&gt;&gt; U : Réponse HTTP
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<section id="mon-premier-webservice" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="mon-premier-webservice"><span class="header-section-number">3.1</span> Mon premier webservice</h3>
<ul class="task-list">
<li><label><input type="checkbox">Ouvrez le fichier <code>app.py</code></label></li>
<li><label><input type="checkbox">Lancez ce fichier</label></li>
<li><label><input type="checkbox">Testez les requêtes suivantes :</label>
<ul>
<li><code>GET http://localhost/hello</code></li>
<li><code>GET http://localhost/hello/everybody</code></li>
</ul></li>
<li><label><input type="checkbox">Arrétez le webservice</label>
<ul>
<li>Cliquez dans le terminal de VSCode puis CTRL + C</li>
</ul></li>
</ul>
<p>En utilisant la liste de personnages définie dans le fichier <em>app.py</em>, ajoutez les endpoints suivants :</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>GET localhost:80/character</code> : retournera un json contenant une liste des personnages</label></li>
<li><label><input type="checkbox"><code>PUT localhost:80/character/{id}</code> qui modifiera le nom du personnage à l’index <code>{id}</code> à partir d’un body</label></li>
<li><label><input type="checkbox"><code>DELETE localhost:80/character/{id}</code> qui supprimera l’élément à l’index <code>{id}</code></label></li>
</ul>
<p>Pour tester les endpoints nécessitant un body json, vous pouvez utiliser :</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"nom"</span><span class="fu">:</span><span class="st">"Agneta"</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">30</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ludo2ne\.github\.io\/ENSAI-2A-Projet-info\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Website built with <a href="https://quarto.org/" class="external" target="_blank">Quarto</a> <br> <a href="https://github.com/ludo2ne/ENSAI-2A-Projet-info" class="external" target="_blank">Code source</a></p>
</div>
  </div>
</footer>




</body></html>